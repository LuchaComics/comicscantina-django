{% include 'api/receipt.html' %}
<script>
    //-------------------------------------//
    // Fix jQuery CSFR Code Issue - 1 of 2 //
    //-------------------------------------//
    // Note: https://docs.djangoproject.com/en/1.8/ref/csrf/
    function csrfSafeMethod(method) {
        // these HTTP methods do not require CSRF protection
        return (/^(GET|HEAD|OPTIONS|TRACE)$/.test(method));
    }

    $(document).ready(function () {
        //-------------------------------------//
        // Fix jQuery CSFR Code Issue - 2 of 2 //
        //-------------------------------------//
        // Note: https://docs.djangoproject.com/en/1.8/ref/csrf/
        $.ajaxSetup({
            beforeSend: function(xhr, settings) {
                if (!csrfSafeMethod(settings.type) && !this.crossDomain) {
                    xhr.setRequestHeader("X-CSRFToken", '{{ csrf_token }}');
                }
            }
        });

        $('body').on('click', '.list-group.group-header', function () {
            if ($(this).next().is(':visible')) {
                $(this).next().slideUp();
                $(this).find('.fa-caret-up').removeClass('fa-caret-up').addClass('fa-caret-down');
            }
            else {
                $(this).next().slideDown();
                $(this).find('.fa-caret-down').removeClass('fa-caret-down').addClass('fa-caret-up');
            }
        });
    });
    
    function print_customer_card()
    {
        alert("TODO: Function not implemented yet.");
    }
    
    function send_invoice()
    {
        alert("TODO: Function not implemented yet.");
    }

    function update_receipt_status()
    {
        var status = $('#id_status').val();
        
        // Create our array of product ID's to include in the Receipt update.
        var products = [];
    {% for product in receipt.products.all %}
        products.push({{ product.product_id }});
    {% endfor %}
    
        // Update the receipt and then do nothing.
        set_receipt({
            'organization': {{ receipt.organization_id }},
            'store': {{ receipt.store_id }},
            'employee': {{ receipt.employee_id }},
            'receipt_id': {{ receipt.receipt_id }},
            'customer': {{ receipt.customer_id }},
            'payment_method': {{ receipt.payment_method }},
            'has_purchased_online': '{{ receipt.has_purchased_online }}',
            'has_tax': '{{ receipt.has_tax }}',
            'tax_rate': {{ receipt.tax_rate }},
            'tax_amount': {{ receipt.tax_amount }},
            'sub_total': {{ receipt.sub_total }},
            'discount_amount': {{ receipt.discount_amount }},
            'total_amount': {{ receipt.total_amount }},
            'has_finished': '{{ receipt.has_finished }}',
            'has_paid': '{{ receipt.has_paid }}',
            'status': status,
            'billing_first_name': '{{ receipt.billing_first_name }}',
            'billing_last_name': '{{ receipt.billing_last_name }}',
            'billing_address': '{{ receipt.billing_address }}',
            'email': '{{ receipt.email }}',
            'billing_phone': '{{ receipt.billing_phone }}',
            'billing_city': '{{ receipt.billing_city }}',
            'billing_province': '{{ receipt.billing_province }}',
            'billing_country': '{{ receipt.billing_country }}',
            'billing_postal': '{{ receipt.billing_postal }}',
            'shipping_first_name': '{{ receipt.shipping_first_name }}',
            'shipping_last_name': '{{ receipt.shipping_last_name }}',
            'shipping_address': '{{ receipt.shipping_address }}',
            'shipping_phone': '{{ receipt.shipping_phone }}',
            'shipping_city': '{{ receipt.shipping_city }}',
            'shipping_province': '{{ receipt.shipping_province }}',
            'shipping_country': '{{ receipt.shipping_country }}',
            'shipping_postal': '{{ receipt.shipping_postal }}',
            'products': products,
        }, function(json_result) {
            // No nothing.
        });
    }
</script>