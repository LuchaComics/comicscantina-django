{% load staticfiles %}
<script>
    $(document).ready(function() {
        // When document loads for first time, disable the issues searching.
        $('#id_issue').prop("disabled", true);
        $('#id_issue_publisher').prop("disabled", true);
                      
        // Whenever user starts typing a textbox, start dynamically
        // making ajax calls to look up the results.
        var thread = null;
        function lookupSeries() {
            var series =  $('#id_series').val();
            var publisher =  $('#id_publisher').val();
            var from =  $('#id_from').val();
            var to =  $('#id_to').val();
                      
            // Print to Console
            console.log('Series: ' + series + ' | Publisher: ' + publisher + ' | From: ' + from + ' | To: ' + to);
            ajax_search_series(series, publisher, from, to); // Call our application and return results.
        }
           
        // SERIES
        $('#id_series').keyup(function() {
            clearTimeout(thread);
            thread = setTimeout(function() { lookupSeries(); }, 500);
        });
                      
        // PUBLISHER
        $('#id_publisher').keyup(function() {
            clearTimeout(thread);
            thread = setTimeout(function() { lookupSeries(); }, 500);
        });
                      
        // FROM
        $('#id_from').keyup(function() {
            clearTimeout(thread);
            thread = setTimeout(function() { lookupSeries(); }, 500);
        });
                      
        // TO
        $('#id_to').keyup(function() {
            clearTimeout(thread);
            thread = setTimeout(function() { lookupSeries(); }, 500);
        });
                      
                      
        // Whenever user starts typing a textbox, start dynamically
        // making ajax calls to look up the results.
        var thread = null;
        function lookupIssues() {
            var series_id = $('#id_hidden_series_id').val();
            var number = $('#id_issue').val();
                      
            // Print to Console
            console.log('series_id: ' + series_id);
            ajax_search_issues(series_id, number, ''); // Call our application and return results.
        }
                      
        // ISSUE
        $('#id_issue').keyup(function() {
            clearTimeout(thread);
            thread = setTimeout(function() { lookupIssues(); }, 500);
        });
                      
        // ISSUE PUBLISHER
        $('#id_issue_publisher').keyup(function() {
            clearTimeout(thread);
            thread = setTimeout(function() { lookupIssues(); }, 500);
        });
        
        // Enables the 'Advanced Search' button to load up the advanced menu.
        $('#issues-adv-search-toggle, #series-adv-search-toggle').on('click', function(){
            $(this).next().next().slideToggle();
        });
                      
        // When document load, enable 'Advanced Search' button to cause a drop
        // down animation with more search results.
        $('body').on('click', '#search-series-list .inventory-search-list .search-list-item', function(){
            $('#search-series-list .inventory-search-list .search-list-item').removeClass('bg-info-dark');
            $(this).addClass('bg-info-dark');
                     
            // this is to get the series id from the element tag (issue.html)
            // <div class="list-group-item clearfix search-list-item" onclick="window.location='inventory_add_details.html';" data-series-id="series id goes here">
                                   
            // get issues for series id here
            var series_id = $(this).data('series-id');
                     
            // Enable Issue Searching UI
            $('#id_issue').prop("disabled", false);
            $('#id_issue_publisher').prop("disabled", false);
                     
            // Save ID to hidden field.
            $('#id_hidden_series_id').val(series_id);
                     
            // Lookup the series.
            ajax_search_issues(series_id, '', '');
        });
    });
    
    function ajax_search_series(series, publisher, from, to)
    {
        var url = '/inventory/search_series';
        
        $.ajax( url, {
            data: {
               'series' : series,
               'publisher' : publisher,
               'from' : from,
               'to' : to,
               'csrfmiddlewaretoken': '{{ csrf_token }}',
            },
            type: 'post',
            success: function(result) {
               // success code execution here
               $('#ajax_series_results_placeholder').html(result); // Update UI.
            },
            error: function(xhr,status,error) {
            
            // error code here
            },
            complete: function(xhr,status) {
               // completion code here
            }
        });
    }
                    
    function ajax_search_issues(series_id, issue_number, publisher)
    {
        var url = '/inventory/search_issues';
        
        $.ajax( url, {
            data: {
                'series_id' : series_id,
                'issue_number' : issue_number,
                'publisher' : publisher,
                'csrfmiddlewaretoken': '{{ csrf_token }}',
            },
            type: 'post',
                success: function(result) {
                // success code execution here
                $('#ajax_issues_results_placeholder').html(result); // Update UI.
            },
            error: function(xhr,status,error) {
                // error code here
            },
            complete: function(xhr,status) {
                // completion code here
            }
        });
    }
</script>