{% load staticfiles %}
<!-- this is mainly for data that needs to be loaded when the page is loaded -->
<script>
    $(document).ready(function () {
        ////////////////////////////////////////////////////////////////////////
        // GUI MECHANICS
        // The code below will load up all the jQuery code necessary for
        // providing fancy effects when clicking on search results.
        //
        $('body').on('click', '.panel-tabs li:not(.product-type)', function(){
            $('.panel-tabs li.selected').removeClass('selected');
            $(this).addClass('selected');
        });
                      
        $('body').on('click', '.btn-add-filter', function(){
            var search_filter = $('.search-filter:first').clone();
            $(search_filter).find('input').val('');
            $('.btn-add-filter').parent().before(search_filter);
        });
                      
        $('body').on('click', '.product-item', function () {
            // for the first case, adding in a data value (line 4 above)
            var issue_id = $(this).data('issue-id');
            alert(issue_id);
                                   
            // for the second case, adding in a hidden input field (line 14 above)
            //    var issue_id_2 = $(this).find('.issue-id-field').val();
            //  alert(issue_id_2);
                                   
            // this should redirect to the add details page using the issue id
            window.location = 'inventory_add_comic_db/' + issue_id; // or however you want the url to be
        });
            
                      
                      
        $('body').on('click', '.btn-remove-filter', function(){
            $(this).parentsUntil('.search-box').detach().remove();
        });
                    
        $('body').on('mouseover', '.product-item', function(){
            $(this).find('.add-message').css('display','block');
        });
                      
        $('body').on('mouseout', '.product-item', function(){
            $(this).find('.add-message').css('display','none');
        });
                      
        $('body').on('click', '.product-listing-header .product-type-minimize', function(){
            if( $(this).find('em').hasClass('fa-caret-down') ) {
                $(this).parentsUntil('.product-type-listing').next().slideUp();
                $(this).find('em').removeClass('fa-caret-down').addClass('fa-caret-right');
            }
            else{
                $(this).parentsUntil('.product-type-listing').next().slideDown();
                $(this).find('em').removeClass('fa-caret-right').addClass('fa-caret-down');
            }
        });
                   
        ////////////////////////////////////////////////////////////////////////
        // DYNAMIC SEARCHING (AKA AJAX SEARCHING)
        // The following code will provide all the necessary functions
        // which allow dynamic searching of comic books...
        //
        // Whenever user starts typing a textbox, start dynamically
        // making ajax calls to look up the results.
        var thread = null;
        function lookupComics() {
            var series =  $('#id_series').val();
            var issue_num =  $('#id_issue').val();
            var genre =  $('#id_genre').val();
            var publisher =  $('#id_publisher').val();
            var from =  $('#id_from').val();
            var to =  $('#id_to').val();
                      
            // Print to Console
            console.log('Series: ' + series + ' | Issue #: ' + issue_num +
                        ' | Publisher: ' + publisher + ' | From: ' + from +
                        ' | To: ' + to + ' | Genre: ' + genre);
                      
            // Call our application and return results.
            ajax_search_comics(series, issue_num, publisher, genre, from, to);
        }
                      
        // SERIES
        $('#id_series').keyup(function() {
            clearTimeout(thread);
            thread = setTimeout(function() { lookupComics(); }, 500);
        });
                      
        // PUBLISHER
        $('#id_publisher').keyup(function() {
            clearTimeout(thread);
            thread = setTimeout(function() { lookupComics(); }, 500);
        });
                      
        // FROM
        $('#id_from').keyup(function() {
            clearTimeout(thread);
            thread = setTimeout(function() { lookupComics(); }, 500);
        });
                    
        // TO
        $('#id_to').keyup(function() {
            clearTimeout(thread);
            thread = setTimeout(function() { lookupComics(); }, 500);
        });
                    
        // ISSUE
        $('#id_issue').keyup(function() {
            clearTimeout(thread);
            thread = setTimeout(function() { lookupComics(); }, 500);
        });
                      
        // GENRE
        $('#id_genre').keyup(function() {
            clearTimeout(thread);
            thread = setTimeout(function() { lookupComics(); }, 500);
        });
    });
    
    function ajax_search_comics(series, issue_num, publisher, genre, from, to)
    {
        var url = '/inventory/{{ org_id }}/{{ store_id }}/add/search_comics';
        
        $.ajax( url, {
            data: {
               'series' : series,
               'issue_num': issue_num,
               'publisher' : publisher,
               'genre': genre,
               'from' : from,
               'to' : to,
               'csrfmiddlewaretoken': '{{ csrf_token }}',
            },
            type: 'post',
            success: function(result) {
               // success code execution here
               $('#ajax_search_results_placeholder').html(result); // Update UI.
            },
            error: function(xhr,status,error) {
               // error code here
            },
            complete: function(xhr,status) {
               // completion code here
            }
        });
    }
</script>