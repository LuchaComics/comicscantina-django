{% load staticfiles %}
{% include 'api/receipt.html' %}

{% include 'api/store.html' %}
{% include 'api/organization.html' %}
{% include 'api/section.html' %}
{% include 'api/comic.html' %}
{% include 'api/product.html' %}
{% include 'api/common_js.html' %}

<script>    
    var mySwiper = new Swiper('.swiper-container', {
        pagination: '.box-pagination',
        keyboardControl: true,
        paginationClickable: true,
        slidesPerView: 'auto',
        autoResize: true,
        resizeReInit: true,
    })

    $('.prevControl').on('click', function (e) {
        e.preventDefault()
        mySwiper.swipePrev()
    })
    $('.nextControl').on('click', function (e) {
        e.preventDefault()
        mySwiper.swipeNext()
    })
    
    function ajax_add_to_cart(product_id)
    {
        // STEP 1: Get the current cart
        {% if receipt != None %}
        get_receipt({{ receipt.receipt_id }}, function(json_results) {
            var products = json_results['products'];
                    
            // STEP 2 - 1of2: Check to see if the product already exists
            //                in the shopping cart and do not add if it
            //                already does, else add it.
            var product_exists_in_cart = false;
            var sub_total = 0;
            for(var i=0; i < products.length; i++) {
                if (products[i] == product_id) {
                    product_exists_in_cart = true;
                };
            }
                    
            // STEP 2 - 2of2: Add the new product into it.
            if (!product_exists_in_cart) {
                products.push(product_id);
                json_results['products'] = products;
                    
                // STEP 3: Update the cart.
                set_receipt(json_results, function(json_results2) {
                    
                    // STEP 4: Update that receipt by re-computing the totals
                    perform_receipt_checkout_computation({{ receipt.receipt_id }}, function(json_results3) {
                        location.reload(true); // Reload page with cache.
                    });
                    
                });
            } else {
                console.log("Duplicate item in product detected, not adding to cart.");
            }
                    
        });
        {% endif %}
    }

    function ajax_remove_from_cart(product_id)
    {
        var receipt_id = parseInt({{ receipt.receipt_id }});
        
        // STEP 1: Get the current Receipt.
        {% if receipt != None %}
        get_receipt(receipt_id, function(json_results) {
            
            // STEP 2: Remove Product from the Receipt.
            var products = json_results['products'];
            var i = products.indexOf(product_id);
            if(i != -1) {
                products.splice(i, 1);
            }
            json_results['products'] = products;
                    
            // STEP 3: Update the cart.
            set_receipt(json_results, function(json_results2) {

                // STEP 4: Update that receipt by re-computing the totals
                perform_receipt_checkout_computation(receipt_id, function(json_results3) {
                    location.reload(true); // Reload page with cache.
                });
                        
            });
                    
        });
        {% endif %}
    }
</script>