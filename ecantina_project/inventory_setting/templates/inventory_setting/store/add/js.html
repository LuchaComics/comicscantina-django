{% include 'api/imageupload.html' %}
{% include 'api/store.html' %}
{% include 'api/organization.html' %}
{% include 'api/section.html' %}
<!-- this is mainly for data that needs to be loaded when the page is loaded -->
<script>
    //-------------------------------------//
    // Fix jQuery CSFR Code Issue - 1 of 2 //
    //-------------------------------------//
    // Note: https://docs.djangoproject.com/en/1.8/ref/csrf/
    function csrfSafeMethod(method) {
        // these HTTP methods do not require CSRF protection
        return (/^(GET|HEAD|OPTIONS|TRACE)$/.test(method));
    }

    $(document).ready(function () {
        //-------------------------------------//
        // Fix jQuery CSFR Code Issue - 2 of 2 //
        //-------------------------------------//
        // Note: https://docs.djangoproject.com/en/1.8/ref/csrf/
        $.ajaxSetup({
            beforeSend: function(xhr, settings) {
                if (!csrfSafeMethod(settings.type) && !this.crossDomain) {
                    xhr.setRequestHeader("X-CSRFToken", '{{ csrf_token }}');
                }
            }
        });
                      
        /**
         *  The following section adds auto-complete fields for the following
         *  textfields.
         */
                      
        $(function() {
            var availableTags = [
                "Ontario",
                "Quebec",
                "Nova Scotia",
                "New Brunswick",
                "Manitoba",
                "British Columbia",
                "Prince Edward Island",
                "Saskatchewan",
                "Alberta",
                "Newfoundland and Labrador",
            ];
            $( "#id_province" ).autocomplete({
                source: availableTags
            });
        });
                      
        $(function() {
            var availableTags = [
                "Canada",
                "United States",
            ];
            $( "#id_country" ).autocomplete({
                source: availableTags
            });
        });
                      
        
    });

    // this is to upload the cover image
    function ajax_upload_image() {
        if ($('#id_image').val() == "") {
           alert('Please select an image to upload');
           return false;
        }
    
        var image = document.getElementById('id_image').files[0];
        var upload_id = $('#id_hidden_upload_id').val();
                      
        // Insert or Update.
        set_imageupload(upload_id, false, image, 0, function(json_result) {
            $('#logo-image').attr('src', json_result['image']);
            $('#id_hidden_upload_id').val(json_result['upload_id']);
        });

    }

    function ajax_save_add() {
        var data = new FormData();
        // Store
        data.append('organization', '{{ org.org_id }}');
        data.append('joined', $('#id_joined').val());
        data.append('email', $('#id_email').val());
        data.append('logo', $('#id_hidden_upload_id').val());
        data.append('name', $('#id_name').val());
        data.append('description', $('#id_description').val());
        data.append('phone', $('#id_phone').val());
        data.append('fax', $('#id_fax').val());
        data.append('website', $('#id_website').val());
        data.append('twitter_url', $('#id_twitter_url').val());
        data.append('facebook_url', $('#id_facebook_url').val());
        data.append('instagram_url', $('#id_instagram_url').val());
        data.append('linkedin_url', $('#id_linkedin_url').val());
        data.append('github_url', $('#id_github_url').val());
        data.append('google_url', $('#id_google_url').val());
        data.append('youtube_url', $('#id_youtube_url').val());
        data.append('flickr_url', $('#id_flickr_url').val());
        data.append('street_number', $('#id_street_number').val());
        data.append('street_name', $('#id_street_name').val());
        data.append('unit_number', $('#id_unit_number').val());
        data.append('city', $('#id_city').val());
        data.append('country', $('#id_country').val());
        data.append('province', $('#id_province').val());
        data.append('postal', $('#id_postal').val());
        // Store Hours
        data.append('monday_to', $('#id_monday_to').val());
        data.append('monday_from', $('#id_monday_from').val());
        data.append('tuesday_to', $('#id_tuesday_to').val());
        data.append('tuesday_from', $('#id_tuesday_from').val());
        data.append('wednesday_to', $('#id_wednesday_to').val());
        data.append('wednesday_from', $('#id_wednesday_from').val());
        data.append('thursday_to', $('#id_thursday_to').val());
        data.append('thursday_from', $('#id_thursday_from').val());
        data.append('friday_to', $('#id_friday_to').val());
        data.append('friday_from', $('#id_friday_from').val());
        data.append('saturday_to', $('#id_saturday_to').val());
        data.append('saturday_from', $('#id_saturday_from').val());
        data.append('sunday_to', $('#id_sunday_to').val());
        data.append('sunday_from', $('#id_sunday_from').val());
        data.append('is_open_monday', $('#id_is_open_monday').is(':checked'));
        data.append('is_open_tuesday', $('#id_is_open_tuesday').is(':checked'));
        data.append('is_open_wednesday', $('#id_is_open_wednesday').is(':checked'));
        data.append('is_open_thursday', $('#id_is_open_thursday').is(':checked'));
        data.append('is_open_friday', $('#id_is_open_friday').is(':checked'));
        data.append('is_open_saturday', $('#id_is_open_saturday').is(':checked'));
        data.append('is_open_sunday', $('#id_is_open_sunday').is(':checked'));
        
        // Send the "FormData" object to be sent through REST and get updated.
        set_store(0, data, function(json_result) {
            var store_id = json_result['store_id'];
                  
            // Update the store logo and tell the system
            var upload_id = $('#id_hidden_upload_id').val();
            set_imageupload(upload_id, true, null, {{ employee.employee_id }}, function(json_result) {
                window.location="/inventory/{{ org.org_id }}/{{ store.store_id }}/settings/store/" + store_id;
            });
                  
            
        });

    }
</script>