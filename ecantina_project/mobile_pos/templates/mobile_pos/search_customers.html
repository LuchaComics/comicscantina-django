{% load staticfiles %}
{% include 'api/login.html' %}
{% include 'api/receipt.html' %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>E-Cantina Cart Management</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link rel="stylesheet" href="http://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.css" />
    <!--    <link rel="stylesheet" href="{% static 'mobilepos/css/bootstrap.min.css' %}" />-->
    <!--    <link rel="stylesheet" href="{% static 'mobilepos/css/bootstrap-theme.css' %}" />-->
    <link rel="stylesheet" href="{% static 'mobilepos/css/bootstrap.css' %}" type="text/css" />
    <link rel="stylesheet" href="{% static 'mobilepos/css/scanner.css' %}" type="text/css" />
    <script src="http://code.jquery.com/jquery-1.11.1.min.js"></script>
    <script src="http://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
</head>
<body>



<!-- ---------- checkout customer lookup ------------- -->
<div data-role="page" id="checkout-customer-lookup" defaultPageTransition="slide">
    <!-- ---------- header------------- -->
    <div data-role="header" data-theme="b" data-id="header-nav" data-position="fixed" >
        <div class="header-logo">
            <img src="img/logo.png" alt="Comics Cantina" />
        </div>
        <div class="header-title">
            <h1>Cart Management</h1>
        </div>
        <div class="header-nav">
            <a onclick="window.location='#checkout-main-menu';" class="ui-btn ui-icon-back ui-btn-icon-notext ui-corner-all"></a>
            <a href="#nav-panel-customer-lookup" class="ui-btn ui-icon-bars ui-btn-icon-notext ui-corner-all"></a>
        </div>
    </div>
    
    <div data-role="panel" data-position="right" data-display="overlay" data-theme="a" id="nav-panel-customer-lookup" align="center">
        <img src="img/user.jpg" />
        <div class="text-left">
            <h4 class="text-center">Hi, Rodolfo</h4>
            <div class="divider"></div>
            <h5>Store Name</h5>
            <h5>Store Address</h5>
            <h5>Cart Sessions: 2</h5>
            <h5>Total Sales Today: 12</h5>
        </div>
        <a onclick="window.location='dashboard.html#dashboard';" class="ui-btn ui-shadow ui-corner-all ui-btn-b ui-mini">Main Menu</a>
        <a onclick="window.location='index.html#login-page';" class="ui-btn ui-shadow ui-corner-all ui-btn-b ui-mini">Logout</a>
    </div><!-- /panel -->
    
    <!-- ---------- content ------------- -->
    <div data-role="content" align="center" data-theme="a">
        <div class="row">                            <!-- row -->
            <div class="container">
                <form>
                    <input type="search" name="search" id="search" value="" placeholder="Search first name, last name or email">
                        <input type="button" id="btnLookupCustomer" value="Lookup Customer" class="ui-btn ui-shadow ui-corner-all w100" />
                        </form>
                
                <ul data-role="listview" data-inset="true" id="customer-results" style="display:none;">
                    <li data-role="list-divider"><h4>Customers</h4><span class="ui-li-count">2</span></li>
                    <li><a onclick="window.location='cart.html#cart-overview';"><span>John Doe</span><span class="text-right">john@email.com</span></a></li>
                    <li><a onclick="window.location='cart.html#cart-overview';"><span>Bill Smith</span><span class="text-right">bill@email.com</span></a></li>
                </ul>
            </div>
        </div>
    </div>
    
</div>

<script>
    //-------------------------------------//
    // Fix jQuery CSFR Code Issue - 1 of 2 //
    //-------------------------------------//
    // Note: https://docs.djangoproject.com/en/1.8/ref/csrf/
    function csrfSafeMethod(method) {
        // these HTTP methods do not require CSRF protection
        return (/^(GET|HEAD|OPTIONS|TRACE)$/.test(method));
    }

    $(document).ready(function () {
        //-------------------------------------//
        // Fix jQuery CSFR Code Issue - 2 of 2 //
        //-------------------------------------//
        // Note: https://docs.djangoproject.com/en/1.8/ref/csrf/
        $.ajaxSetup({
            beforeSend: function(xhr, settings) {
                if (!csrfSafeMethod(settings.type) && !this.crossDomain) {
                    xhr.setRequestHeader("X-CSRFToken", '{{ csrf_token }}');
                }
            }
        });
    });
                  
    /**
     *  Function will log the User. from the system and return them to the
     *  login page.
     */
    function ajax_logout() {
        sign_off(
            function(json_result) {
                // Return the the login screen when successsfully logged out.
                window.location="/mobile/pos/login";
            },
            function(error_callback) {
                $('.alert-danger').css('display','block');
                $('.alert-danger').text(error_callback.message);
                console.log(error_callback.message);
            }
        ); // End Login
    }

    function removeCart(){
        if( remove_cart == true ){
            // delete the cart

            window.location="dashboard.html#dashboard";
        }
    }

    function removeCartItem(){
        if( remove_item == true ) {
            // remove item from cart

            $(removed_item).detach().remove();
            $('#remove-popup').popup('close');
            $('#cart-items').listview('refresh');
            var items = $('#cart-items .ui-li-divider .ui-li-count').text( $('#cart-items .cart-item').length );
            refreshCartTotal();
        }

        remove_item = false;
    }

    function refreshCartTotal(){
        var total = 0;
        $('.item-price').each(function(index, el){
            var price = $(el).text();
            price = price.substring(1);
            total += parseFloat(price);
        });
        total = "$" + total.toFixed(2);
        $('.cart-total').text(total);
        $('#cart-items').listview('refresh');
    }



    $(document).ready(function(){
        $('.btnRemoveCartItem').on('click', function(){
            var cartItem = $(this).parentsUntil('ul').find('span:first-child').text();
            $('#remove-popup div p.cart-item-title').text(cartItem);
            removed_item = $(this).parentsUntil('ul');
            $('#remove-popup').popup('open');
        });

        $('#btnCancelSale').on('click', function(){
           $('#cancel-popup').popup('open');
        });

    });
</script>

</body>
</html>