{% load staticfiles %}
{% include 'api/receipt.html' %}
<script>
    //-------------------------------------//
    // Fix jQuery CSFR Code Issue - 1 of 2 //
    //-------------------------------------//
    // Note: https://docs.djangoproject.com/en/1.8/ref/csrf/
    function csrfSafeMethod(method) {
        // these HTTP methods do not require CSRF protection
        return (/^(GET|HEAD|OPTIONS|TRACE)$/.test(method));
    }

    $(document).ready(function () {
        //-------------------------------------//
        // Fix jQuery CSFR Code Issue - 2 of 2 //
        //-------------------------------------//
        // Note: https://docs.djangoproject.com/en/1.8/ref/csrf/
        $.ajaxSetup({
            beforeSend: function(xhr, settings) {
                if (!csrfSafeMethod(settings.type) && !this.crossDomain) {
                    xhr.setRequestHeader("X-CSRFToken", '{{ csrf_token }}');
                }
            }
        });
                      
        // Run the code to close the cart as you land on this page.
       // var receipt_id = parseInt({{ receipt.receipt_id }});
        //ajax_close_cart(receipt_id);
    });


    function ajax_close_cart(receipt_id)
    {
        // STEP 1: Get the current Receipt.
        {% if receipt != None %}
        get_receipt(receipt_id, function(json_results) {
            // Change the status to indicate the cart has been processed.
            json_results['has_finished'] = true;
                    
            // STEP 2: Update the cart.
            set_receipt(json_results, function(json_results2) {
                console.log("Cart Closed"); // Do nothing.
            });

        }); // End Get Receipt
        {% endif %}
    }
</script>