{% load staticfiles %}
<!-- this is mainly for data that needs to be loaded when the page is loaded -->
<script>
    $(document).ready(function() { // Run the following when the page loads up..
        ajax_refresh_table(); // Refresh the table for the first time.
              
        // The following code will poll the server every 10 seconds to see if
        // we have the latest data.
        //window.setInterval(function(){
        //    ajax_refresh_table();
        //}, 5000);
    });
    
    function ajax_refresh_table() {
        var url = "/api/carts/?is_closed=False&employee={{ employee.employee_id }}";
        jQuery.ajax({
            url: url,
            cache: false,
            contentType: false,
            processData: false,
            type: 'GET',
            success: function(result){
                    generate_table(result);
            },
            error: function(xhr,status,error) {
                console.debug(status + ': ' + error + ' -- ' + xhr.responseText);
            },
            complete: function(xhr,status) {
                
            }
        });
    }

    function generate_table(result)
    {
        // Debugging code
        //var json_text = JSON.stringify(result, null, 2);
        //var obj = JSON.parse(json_text);
    
        var html = '<div class="table-responsive">';
        html += '<h2>Open Sessions</h2>';
        html += '<table class="table table-striped">';
        html += '<thead>';
        html += '<tr>';
        html += '<th>Cart ID #</th>';
        html += '<th>Function</th>';
        html += '</tr>';
        html += '</thead>';
        html += '<tbody>';
        
        $(result).each(function(iter,val){
            html += '<tr>';
            html += '<td>' + val['cart_id'] + '</td>';
            html += '<td>' + '<button type="submit" class="btn btn-labeled btn-success" style="font-size: 23pt;margin-left: auto;margin-right: auto;" onclick=""><span class="btn-label"><i class="fa fa-shopping-cart"></i></span>Continue Existing Checkout</button>' + '</td>';
            html += '</tr>';
        });
        html += '</tbody></table></div>';
        $('#id_table_placeholder').html(''); // Clear Table
        $(html).appendTo('#id_table_placeholder'); // Load Table.
    }
</script>